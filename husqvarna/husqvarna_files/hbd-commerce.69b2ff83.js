"use strict";(self.webpackHbd=self.webpackHbd||[]).push([[29],{11643:function(t,e,r){r.d(e,{W:function(){return i}});var a=r(83438),n=r(82754),o=r(60030);const c=(0,n.Z0)({name:"COMMERCE",initialState:{},reducers:{setToken:(t,{payload:e})=>{(0,a.QK)(o.A,e),t.token=e}}}),{setToken:i}=c.actions;e.A=c.reducer},45345:function(t,e,r){var a=r(97279),n=r(4806),o=r(11643),c=r(48127);(0,a.Km)({[n.cA]:o.A}),(0,a.gV)(c.Ay)},48127:function(t,e,r){r.d(e,{mC:function(){return d}});var a=r(83438),n=r(74161),o=r(71111),c=r(4806),i=r(11643);const s=t=>{const e=(0,n.Ay)(t.getState(),c.AG);if(!e.name)throw new Error("No site ID in settings.");return(0,a.KU)().refreshCommerceToken({siteName:e.name}).then((e=>{const r=e.site?.commerce?.authenticate.refresh;return!!r&&(t.dispatch((0,i.W)(r)),!0)})).catch((()=>!1))},d=t=>{const e=(0,n.Ay)(t.getState(),c.cA);if(e.token)return Promise.resolve(e.token);const r=(0,n.Ay)(t.getState(),c.AG);if(!r.name)throw new Error("Current page have no 'Site ID' in redux Site store");return(0,a.KU)().createGuestCart({siteName:r.name}).then((e=>{const r=e.site?.commerce?.authenticate.guest;if(!r)throw new Error("Wasn't able to get a token");return t.dispatch((0,i.W)(r)),r}))},u=(t,e)=>{const r=(0,n.Ay)(t.getState(),c.L4),a=[],o=[];for(let t=0;t<e.lines.length;t+=1){const n=e.lines[t],c=r.cart.rows.find((t=>t.id===n.id));c||o.push(n.id);const i={...c,id:n.id,articleId:n.productId,productId:n.productId,quantity:n.quantity,bonus:n.bonus,title:n.articleName||void 0,rowTotal:{regular:n.totalPrice?.displayPrice?.amount??void 0,campaign:n.totalCampaignPrice?.displayPrice?.amount??void 0,currency:n.totalPrice?.displayPrice?.currency||""}};a.push(i)}return{rowsNeedingMeta:o,cart:{id:e.id,rows:a,grandTotal:e.grandTotal?.amount||void 0,currency:e.grandTotal?.currency||"",discount:e.discount?.amount||void 0,checkoutUrl:e.checkoutUrl}}};let m;e.Ay=t=>e=>r=>{if(o.Ts.pending.match(r)){const o=(0,n.Ay)(t.getState(),c.AG);if(!o.name)return console.error("No Site Name in Settings"),void e(r);const i=(0,a.KU)();r.meta.arg.ecomCallback=()=>s(t).then((e=>{if(e)return i.getCart({siteName:o.name}).then((e=>{const r=e.site?.commerce?.cart;return r?u(t,r):{error:new Error("No cart")}}))})).catch((t=>({error:t}))).finally((()=>{m||(m=window.setInterval((()=>s(t)),9e5))})),e(r)}else if(o.bE.pending.match(r)){const o=(0,n.Ay)(t.getState(),c.AG);if(!o.name)return console.error("No Site Name in Settings"),void e(r);const{id:i,articleId:s}=r.meta.arg.row,m=(0,a.KU)();r.meta.arg.ecomCallback=()=>d(t).then((()=>m.addToCart({siteName:o.name,productId:r.meta.arg.row.productId,articleId:r.meta.arg.row.articleId,quantity:r.meta.arg.row.quantity,returnOld:r.meta.arg.wantsToReturn,dealerId:r.meta.arg.dealerId}))).then((e=>{const r=e.site?.commerce?.cart?.add;if(!r)throw new Error("No cart");const{rowsNeedingMeta:a,cart:n}=u(t,r),o=n.rows.find((t=>t.articleId===s))?.id;return{rowId:o,cart:n,rowsNeedingMeta:a}})).catch((t=>({rowId:i,error:t}))),e(r)}else if(o.vh.pending.match(r)){const o=(0,n.Ay)(t.getState(),c.AG);if(!o.name)return console.error("No Site Name in Settings"),void e(r);const{getState:i}=t,s=(0,n.Ay)(i(),c.L4).cart.rows.find((t=>t.id===r.meta.arg.rowId));if(!s)throw new Error("No row found with that ID");const m=(0,a.KU)();r.meta.arg.ecomCallback=()=>d(t).then((()=>m.updateCart({siteName:o.name,cartLineId:r.meta.arg.rowId,quantity:r.meta.arg.quantity,returnOld:r.meta.arg.wantsToReturn}))).then((e=>{const r=e.site?.commerce?.cart?.update;if(!r)throw new Error("No cart");return{...u(t,r),rowId:s.id}})).catch((t=>({error:t,rowId:s.id}))),e(r)}else if(o.B9.pending.match(r)){const o=(0,n.Ay)(t.getState(),c.AG);if(!o.name)return console.error("No Site Name in Settings"),void e(r);const{rowId:i}=r.meta.arg,s=(0,a.KU)();r.meta.arg.ecomCallback=()=>d(t).then((()=>s.updateCart({siteName:o.name,cartLineId:i,quantity:0}))).then((e=>{const r=e.site?.commerce?.cart?.update;if(!r)throw new Error("No cart");return{...u(t,r),rowId:i}})).catch((t=>({error:t,rowId:i}))),e(r)}else if(o.Pt.match(r)){e(r);const a=(0,n.Ay)(t.getState(),c.L4);a.cart.checkoutUrl&&(window.location.href=a.cart.checkoutUrl)}else e(r)}},60030:function(t,e,r){r.d(e,{A:function(){return a}});const a="X-Commerce-Token"}},function(t){t.O(0,[497,96,479,907],(function(){return e=45345,t(t.s=e);var e}));t.O()}]);