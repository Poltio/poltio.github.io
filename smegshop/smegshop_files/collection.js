class FacetForm extends HTMLFormElement{constructor(){super(),this.dirty=!1,this.cachedMap=new Map,this.addEventListener("change",this.onFormChange),this.addEventListener("submit",this.onFormSubmit)}onFormChange(){this.dirty=!0,this.dispatchEvent(new Event("submit",{cancelable:!0}))}onFormSubmit(event){if(event.preventDefault(),!this.dirty)return;const url=this.buildUrl().toString();this.renderSection(url,event)}buildUrl(){const searchParams=new URLSearchParams(new FormData(this)),url=new URL(this.action);return url.search="",searchParams.forEach((value,key)=>url.searchParams.append(key,value)),["page","filter.v.price.gte","filter.v.price.lte"].forEach(item=>{url.searchParams.get(item)===""&&url.searchParams.delete(item)}),url.searchParams.set("section_id",theme.utils.sectionId(this)),url}updateURLHash(url){const clonedUrl=new URL(url);clonedUrl.searchParams.delete("section_id"),history.replaceState({},"",clonedUrl.toString())}beforeRenderSection(){const items=document.getElementById("ProductGridContainer").querySelectorAll(".product-card__outer"),translateY=theme.config.motionReduced?0:50;setTimeout(()=>{const target=document.querySelector(".collection");window.scrollTo({top:target.getBoundingClientRect().top+window.scrollY-(theme.config.isTouch||theme.config.mqlSmall?95:20),behavior:theme.config.motionReduced?"auto":"smooth"});const drawer=document.getElementById("FacetDrawer");drawer&&drawer.classList.add("loading")},100)}afterRenderSection(){const items=document.getElementById("ProductGridContainer").querySelectorAll(".product-card__outer"),translateY=theme.config.motionReduced?0:50,drawer=document.getElementById("FacetDrawer");drawer&&drawer.classList.remove("loading"),document.dispatchEvent(new CustomEvent("collection:reloaded"))}renderSection(url,event){this.cachedMap.has(url)?this.renderSectionFromCache(url,event):this.renderSectionFromFetch(url,event),this.hasAttribute("data-history")&&this.updateURLHash(url),this.dirty=!1}renderSectionFromFetch(url,event){this.abortController?.abort(),this.abortController=new AbortController,this.beforeRenderSection();const start=performance.now();fetch(url,{signal:this.abortController.signal}).then(response=>response.text()).then(responseText=>{const execution=performance.now()-start;setTimeout(()=>{this.renderFilters(responseText,event),this.renderFiltersActive(responseText),this.renderProductGridContainer(responseText),this.renderProductCount(responseText),this.renderSortBy(responseText),theme.pubsub.publish(theme.pubsub.PUB_SUB_EVENTS.facetUpdate,{responseText}),this.cachedMap.set(url,responseText),this.afterRenderSection()},execution>500?0:500)}).catch(error=>{error.name==="AbortError"?console.log("Fetch aborted by user"):console.error(error)})}renderSectionFromCache(url,event){this.beforeRenderSection(),setTimeout(()=>{const responseText=this.cachedMap.get(url);this.renderFilters(responseText,event),this.renderFiltersActive(responseText),this.renderProductGridContainer(responseText),this.renderProductCount(responseText),this.renderSortBy(responseText),theme.pubsub.publish(theme.pubsub.PUB_SUB_EVENTS.facetUpdate,{responseText}),this.afterRenderSection()},500)}renderFilters(responseText,event){const facetElements=new DOMParser().parseFromString(responseText,"text/html").querySelectorAll("#FacetFiltersContainer [data-filter], #MobileFacetFiltersContainer [data-filter]"),matchesIndex=element=>{const jsFilter=event?event.target.closest("[data-filter]"):void 0;return jsFilter?element.getAttribute("data-index")===jsFilter.getAttribute("data-index"):!1};Array.from(facetElements).filter(element=>!matchesIndex(element)).forEach(element=>{const filter=document.querySelector(`[data-filter][data-index="${element.getAttribute("data-index")}"]`);filter!==null&&(filter.tagName==="DETAILS"?filter.querySelector("summary + *").innerHTML=element.querySelector("summary + *").innerHTML:filter.innerHTML=element.innerHTML)})}renderFiltersActive(responseText){const id="FacetFiltersActive";if(document.getElementById(id)===null)return;const parsedHTML=new DOMParser().parseFromString(responseText,"text/html");document.getElementById(id).innerHTML=parsedHTML.getElementById(id).innerHTML}renderProductGridContainer(responseText){const id="ProductGridContainer",container=document.getElementById(id);if(container===null)return;const newContainer=new DOMParser().parseFromString(responseText,"text/html").getElementById(id);if(!newContainer)return;const motionList=newContainer.querySelector("motion-list");motionList&&motionList.setAttribute("motion-reduced",""),container.innerHTML=newContainer.innerHTML}renderProductCount(responseText){const id="ProductCount",target=document.getElementById(id);if(target===null)return;const newCount=new DOMParser().parseFromString(responseText,"text/html").getElementById(id);newCount?target.innerHTML=newCount.innerHTML:target.innerHTML="0 results"}renderSortBy(responseText){const id="SortByContainer",target=document.getElementById(id);if(target===null)return;const newSort=new DOMParser().parseFromString(responseText,"text/html").getElementById(id);newSort&&(target.innerHTML=newSort.innerHTML)}}customElements.define("facet-form",FacetForm,{extends:"form"});class FacetCount extends HTMLElement{constructor(){super()}facetUpdateUnsubscriber=void 0;connectedCallback(){this.facetUpdateUnsubscriber=theme.pubsub.subscribe(theme.pubsub.PUB_SUB_EVENTS.facetUpdate,this.onFacetUpdate.bind(this))}disconnectedCallback(){this.facetUpdateUnsubscriber&&this.facetUpdateUnsubscriber()}get itemCount(){return parseInt(this.innerText)}onFacetUpdate(event){const facetCount=new DOMParser().parseFromString(event.responseText,"text/html").querySelector("facet-count");facetCount&&(this.innerText=facetCount.innerHTML,this.hidden=this.itemCount===0)}}customElements.define("facet-count",FacetCount);class FacetRemove extends MagnetLink{constructor(){super(),this.addEventListener("click",this.onClick)}onClick(event){const form=this.closest('form[is="facet-form"]')||document.querySelector('form[is="facet-form"]');if(form){event.preventDefault();const url=new URL(this.href);url.searchParams.set("section_id",theme.utils.sectionId(form)),form.renderSection(url.toString(),event)}}}customElements.define("facet-remove",FacetRemove,{extends:"a"});class FacetSort extends HTMLElement{constructor(){super(),Motion.inView(this,this.init.bind(this),{margin:"200px 0px 200px 0px"}),this.addEventListener("change",this.onChange),this.button.addEventListener("click",this.show.bind(this)),document.addEventListener("click",this.onWindowClick.bind(this))}get listbox(){return this.querySelector(".sort-listbox")}get button(){return this.querySelector(".sort-by")}init(){this.style.setProperty("--facet-listbox-height",`${this.listbox.getBoundingClientRect().height}px`)}onChange(event){const form=this.closest('form[is="facet-form"]')||document.querySelector('form[is="facet-form"]');if(form){const url=new URL(window.location.href);url.searchParams.set("sort_by",event.target.value),url.searchParams.set("section_id",theme.utils.sectionId(form)),url.searchParams.delete("page"),form.renderSection(url.toString(),event)}this.hide()}show(){this.button.setAttribute("open","")}hide(immediate=!0){if(this.button.hasAttribute("open")){if(setTimeout(()=>{this.button.removeAttribute("open")},100),theme.config.isTouch||document.body.getAttribute("data-button-hover")==="none")return;const btnFill=this.button.querySelector("[data-fill");Motion.animate(btnFill,{y:["0%",immediate?"0%":"-76%"]},{duration:.6,delay:immediate?0:.2})}}onWindowClick(event){this.contains(event.target)||this.button.hasAttribute("open")&&this.hide(!1)}}customElements.define("facet-sort",FacetSort);class FacetSticky extends HTMLElement{constructor(){super(),new IntersectionObserver(this.handleIntersection.bind(this),{rootMargin:`-${screen.availHeight-100}px 0px ${screen.availHeight}px 0px`}).observe(document.querySelector(".collection-section"))}get button(){return this.querySelector(".button")}handleIntersection(entries){entries[0].isIntersecting?Motion.animate(this.button,{opacity:1,visibility:"visible",transform:["translateY(15px)","translateY(0)"]},{duration:1,easing:[.16,1,.3,1]}):Motion.animate(this.button,{opacity:0,visibility:"hidden",transform:["translateY(0)","translateY(15px)"]},{duration:1,easing:[.16,1,.3,1]})}}customElements.define("facet-sticky",FacetSticky);class PriceRange extends HTMLElement{constructor(){super(),this.rangeMin=this.querySelector('input[type="range"]:first-child'),this.rangeMax=this.querySelector('input[type="range"]:last-child'),this.inputMin=this.querySelector('input[name="filter.v.price.gte"]'),this.inputMax=this.querySelector('input[name="filter.v.price.lte"]'),this.inputMin.addEventListener("focus",this.inputMin.select),this.inputMax.addEventListener("focus",this.inputMax.select),this.inputMin.addEventListener("change",this.onInputMinChange.bind(this)),this.inputMax.addEventListener("change",this.onInputMaxChange.bind(this)),this.rangeMin.addEventListener("change",this.onRangeMinChange.bind(this)),this.rangeMax.addEventListener("change",this.onRangeMaxChange.bind(this)),this.rangeMin.addEventListener("input",this.onRangeMinInput.bind(this)),this.rangeMax.addEventListener("input",this.onRangeMaxInput.bind(this))}onInputMinChange(event){event.preventDefault(),event.target.value=Math.max(Math.min(parseInt(event.target.value),parseInt(this.inputMax.value||event.target.max)-1),event.target.min),this.rangeMin.value=event.target.value,this.rangeMin.parentElement.style.setProperty("--range-min",`${parseInt(this.rangeMin.value)/parseInt(this.rangeMin.max)*100}%`)}onInputMaxChange(event){event.preventDefault(),event.target.value=Math.min(Math.max(parseInt(event.target.value),parseInt(this.inputMin.value||event.target.min)+1),event.target.max),this.rangeMax.value=event.target.value,this.rangeMax.parentElement.style.setProperty("--range-max",`${parseInt(this.rangeMax.value)/parseInt(this.rangeMax.max)*100}%`)}onRangeMinChange(event){event.stopPropagation(),this.inputMin.value=event.target.value,this.inputMin.dispatchEvent(new Event("change",{bubbles:!0}))}onRangeMaxChange(event){event.stopPropagation(),this.inputMax.value=event.target.value,this.inputMax.dispatchEvent(new Event("change",{bubbles:!0}))}onRangeMinInput(event){event.target.value=Math.min(parseInt(event.target.value),parseInt(this.inputMax.value||event.target.max)-1),event.target.parentElement.style.setProperty("--range-min",`${parseInt(event.target.value)/parseInt(event.target.max)*100}%`),this.inputMin.value=event.target.value}onRangeMaxInput(event){event.target.value=Math.max(parseInt(event.target.value),parseInt(this.inputMin.value||event.target.min)+1),event.target.parentElement.style.setProperty("--range-max",`${parseInt(event.target.value)/parseInt(event.target.max)*100}%`),this.inputMax.value=event.target.value}}customElements.define("price-range",PriceRange);class InfiniteButton extends HoverButton{constructor(){super(),this.onClickHandler=this.onClick.bind(this)}connectedCallback(){this.addEventListener("click",this.onClickHandler),this.getAttribute("mode")=="infinite"&&Motion.inView(this,this.onClickHandler,{margin:"200px 0px 200px 0px"})}disconnectedCallback(){this.removeEventListener("click",this.onClickHandler)}onClick(){if(this.hasAttribute("aria-busy"))return;this.abortController?.abort(),this.abortController=new AbortController,this.enableLoading();const url=this.buildUrl().toString();fetch(url,{signal:this.abortController.signal}).then(response=>response.text()).then(responseText=>{this.renderPagination(responseText);const isLastPage=this.checkIfLastPage(responseText);this.renderProductGridContainer(responseText,isLastPage)}).catch(error=>{error.name==="AbortError"?console.log("Fetch aborted by user"):console.error(error)})}renderPagination(responseText){const productGridContainer=document.getElementById("ProductGridContainer");if(productGridContainer===null)return;const parsedHTML=new DOMParser().parseFromString(responseText,"text/html"),destination=productGridContainer.querySelector(".pagination"),source=parsedHTML.querySelector(".pagination");source?destination.innerHTML=source.innerHTML:destination.remove()}renderProductGridContainer(responseText,isLastPage=!1){const productGridContainer=document.getElementById("ProductGridContainer");if(productGridContainer===null)return;const parsedHTML=new DOMParser().parseFromString(responseText,"text/html"),destination=productGridContainer.querySelector("motion-list"),source=parsedHTML.querySelector("motion-list");source&&destination&&(source.querySelectorAll(".product-card__outer:not(.product-card__outer--promo").forEach(item=>{destination.appendChild(item)}),destination.reload(),isLastPage&&productGridContainer.classList.add("is-last-page"))}buildUrl(){const url=new URL(this.getAttribute("action"));return url.searchParams.set("section_id",theme.utils.sectionId(this)),url}enableLoading(){this.classList.add("pointer-events-none"),this.setAttribute("aria-busy","true")}checkIfLastPage(responseText){return!new DOMParser().parseFromString(responseText,"text/html").querySelector(".pagination")?.querySelector("button")}}customElements.define("infinite-button",InfiniteButton,{extends:"button"});
//# sourceMappingURL=/cdn/shop/t/5/assets/collection.js.map?v=120271427147612922891750772874
