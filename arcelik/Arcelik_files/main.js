(()=>{"use strict";var t,e=new Uint8Array(16);function i(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(e)}const n=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(t){return"string"==typeof t&&n.test(t)};for(var o=[],r=0;r<256;++r)o.push((r+256).toString(16).substr(1));const s=function(t,e,n){var r=(t=t||{}).random||(t.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){n=n||0;for(var s=0;s<16;++s)e[n+s]=r[s];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]).toLowerCase();if(!a(i))throw TypeError("Stringified UUID is invalid");return i}(r)};var c;function d(){return c}function u(){return localStorage.getItem("h-u-u")||null}(c=localStorage.getItem("h-u-i"))||(c=s(),localStorage.setItem("h-u-i",c));const p="https://v11cf13hx0.execute-api.eu-west-1.amazonaws.com/pixel-prod/",h="v1.1",l="hmz",m="https://6ujl3qfhv7.execute-api.eu-west-1.amazonaws.com/default/external-logger";function f(){var t="";try{t=window.location.href||parent.location.href}catch(t){}return t}function v(t,e,i){var n={type:e,message:i,client_id:t,source_url:f()};try{fetch(m,{method:"POST",body:JSON.stringify(n),mode:"no-cors",headers:{"Content-Type":"application/json"}})}catch(t){}}function g(t,e){var i=void 0;try{if(e&&(e=e.toString().replace("#","")),e&&parseInt(e)==e){var n="aaaaaaaa-aaaa-4aaa-aaaa-aaaaaaaaaaaa",a=0,o=t+e;if(o.length<30){for(;a<o.length;)n=n.replace("a",o[a]),a++;i=n}}else v(t,"gtmPurchaseKey (else) - order id = "+e)}catch(i){v(t,"gtmPurchaseKey (exception) - order id = "+e)}return i}window.hzi=class{constructor(t){var e,i,n;this.app_id=t,this.user_id=u(),this.utms=(e=l,i=null,n=[],location.search.substr(1).split("&").forEach((function(t){(n=t.split("="))[0].startsWith(e)&&(i||(i={}),i[n[0]]=decodeURIComponent(n[1]))})),i),this.setAppId(t),this.setCampaignId(),window.hzp=this,console.log("-I-"),this.order_found=!1,this.order_checks=0}sendEvent(t,e,i){e={event_name:t,event_id:i||s(),user_id:u()||this.user_id,app_id:localStorage.getItem("h-u-a")||this.app_id,humanz_id:d(),source_url:f(),extra_data:e,version:h},fetch(p,{method:"POST",body:JSON.stringify(e),mode:"no-cors",headers:{"Content-Type":"application/json"}})}setCampaignId(){this.utms&&this.sendEvent("campaign",{utms:this.utms})}setAppId(t){!function(t){localStorage.setItem("h-u-a",t)}(t),this.sendEvent("initial")}gtmPurchase(t,e){try{if(t&&"object"==typeof t&&t.length){var i=[],n=void 0;if(e&&"string"==typeof e&&(n=e),window?.dataLayer?.length>0){var a=window.dataLayer.filter((t=>t?.ecommerce)).map((t=>t?.ecommerce?.purchase?.actionField?.id)).filter((t=>!!t));if(a?.length>0)return void this.gtmPurchaseKey(t,e,a[0])}var o=0,r={};t.forEach((t=>{var e=t.sku||t.product_id||t.id||void 0,a=t.price||0,s=parseInt(t.quantity)||1,c=(e+"_"+a).toString();if(r[c]&&r[c].price===a){var d=r[c].index;i[d]&&(i[d].quantity+=s)}else{var u={type:"purchased_item",name:t.name,price:a,sku:e,coupon:t.coupon||n||void 0,influencer:t.influencer||void 0,quantity:s,original:JSON.stringify(t)};i.push(u),r[c]={price:a,index:o},o++}}));var s={cart:i,utms:this.utms};this.sendEvent("purchase",s)}else v(this.app_id,"gtm_invalid_items",JSON.stringify(t))}catch(e){v(this.app_id,"gtm_exception",JSON.stringify(t))}}gtmPurchaseT(t,e,i){this.gtmPurchaseKey(t,e,i)}gtmPurchaseKey(t,e,i){try{if(t&&"object"==typeof t&&t.length){var n=[],a=void 0;e&&"string"==typeof e&&(a=e),i&&(i=i.toString().replace("#",""));var o=0,r={};t.forEach((t=>{var e=t.sku||t.product_id||t.id||void 0,i=t.price||0,s=parseInt(t.quantity)||1,c=(e+"_"+i).toString();if(r[c]&&r[c].price===i){var d=r[c].index;n[d]&&(n[d].quantity+=s)}else{var u={type:"purchased_item",name:t.name,price:i,sku:e,coupon:t.coupon||a||void 0,influencer:t.influencer||void 0,quantity:s,brand:t.brand||void 0,original:JSON.stringify(t)};n.push(u),r[c]={price:i,index:o},o++}}));var s={cart:n,transaction_id:i,utms:this.utms},c=g(this.app_id,i);this.sendEvent("purchase",s,c)}else v(this.app_id,"gtm_invalid_items",JSON.stringify(t))}catch(e){v(this.app_id,"gtm_exception",JSON.stringify(t))}}makePurchase(t){var e=[];t.forEach((t=>{var i=t.name?decodeURI(t.name):void 0,n=t.coupon?decodeURI(t.coupon):void 0,a={type:"purchased_item",name:i,price:t.price,sku:t.sku||t.product_id||t.id||void 0,coupon:n,influencer:t.influencer||void 0,quantity:parseInt(t.quantity)||void 0,original:JSON.stringify(t)};e.push(a)}));var i={cart:e,utms:this.utms};this.sendEvent("purchase",i)}shopify(){console.log("--S--");try{if(window&&window.Shopify||parent&&parent.Shopify){var t=u();window.meta&&window.meta.page&&window.meta.page.customerId&&t!=window.meta.page.customerId&&this.login(window.meta.page.customerId),(window.location.href.includes("checkouts")||parent&&parent.document.URL.includes("checkouts"))&&this.sendEvent("checkout_page",{}),(window.location.href.includes("thank")||parent&&parent.document.URL.includes("thank"))&&this.sendEvent("thank_you_page",{}),this.checkShopifyOrder()}}catch(t){this.sendEvent("failed_shopify",JSON.stringify(t))}}checkShopifyOrder(){var t;if(!this.order_found&&(window.location.href.includes("thank")||parent&&parent.document.URL.includes("thank")))if(window.Shopify&&window.Shopify.checkout?t=window.Shopify.checkout:parent&&parent.Shopify&&parent.Shopify.checkout&&(t=parent.Shopify.checkout),this.order_checks+=1,t&&t.order_id&&t.line_items){var e=t.order_id;this.order_found=!0,this.sendEvent("order_found",{});var i=t.discount?t.discount.code:null,n=t.line_items.map((t=>{var e=parseFloat(t.price||t.line_price||0),n=parseInt(t.quantity)||1,a=i;if(t.discount_allocations&&t.discount_allocations.length>0)for(var o=0;o<t.discount_allocations.length;o++)(r=t.discount_allocations[o])&&(r.description?a=r.description:r.id&&(a=r.id),r.amount&&"number"==typeof(s=parseFloat(r.amount)/n)&&(e-=s));else if(t.applied_discounts&&t.applied_discounts.length>0)for(o=0;o<t.applied_discounts.length;o++){var r,s;(r=t.applied_discounts[o])&&(r.description?a=r.description:r.id&&(a=r.id),r.amount&&"number"==typeof(s=parseFloat(r.amount)/n)&&(e-=s))}return{name:t.title,sku:t.sku||t.product_id,price:e||0,quantity:n,coupon:a}})),a=[];n.forEach((t=>{var e={type:"purchased_item",name:t.name,price:t.price,sku:t.sku||void 0,coupon:t.coupon||void 0,influencer:t.influencer||void 0,quantity:t.quantity||void 0,original:JSON.stringify(t)};a.push(e)}));var o={cart:a,utms:this.utms,transactionId:e},r=g(this.app_id,e);this.sendEvent("purchase",o,r)}else this.order_checks<=15&&window.setTimeout((()=>this.checkShopifyOrder()),1e3)}login(t){try{this.user_id=t,function(t){localStorage.setItem("h-u-u",t)}(t),this.sendEvent("user_login")}catch(t){}}logout(){try{this.user_id=null,localStorage.removeItem("h-u-u"),this.sendEvent("user_logout")}catch(t){}}wixPurchase(t){console.log("-W-");var e=t.contents;e&&e.length&&(t.coupon&&(e=e.map((e=>({...e,coupon:t.coupon})))),this.makePurchase(e))}getHumanzId(){return d()}addToCart(t=[]){var e=[];t.forEach((t=>{var i={type:"add_to_cart",name:t.name?decodeURI(t.name):void 0,price:parseFloat(t.price)||0,sku:t.sku||t.product_id||t.id||void 0,id:t.id||void 0,quantity:parseInt(t.quantity)||0,original:JSON.stringify(t),brand:t.brand||void 0};e.push(i)}));var i={products:e,utms:this.utms};this.sendEvent("add_to_cart",i)}}})();