// Fanplayr Adaptor (kiko) v1.0.25
// Hodor v1.6.2
!function t(e,r,o){function a(i,c){if(!r[i]){if(!e[i]){var s="function"==typeof require&&require;if(!c&&s)return s(i,!0);if(n)return n(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var d=r[i]={exports:{}};e[i][0].call(d.exports,function(t){var r=e[i][1][t];return a(r?r:t)},d,d.exports,t,e,r,o)}return r[i].exports}for(var n="function"==typeof require&&require,i=0;i<o.length;i++)a(o[i]);return a}({1:[function(t,e,r){function o(t,e,r){r=r||500;var o=0,a=setInterval(function(){for(var r=window.dataLayer||[];o<r.length;)n(t,r[o])?e(r[o++],a):o++},r)}function a(t,e,r){for(var o=window.dataLayer||[],a=0;a<o.length;a++)if(n(t,o[a]))return r&&window.clearInterval(r),e?void e(o[a]):o[a]}function n(t,e){return"string"==typeof t||t instanceof String?e[t]:t(e)}var i=e.exports={},c=t("__hodor\\platform.js"),s=t("__hodor\\utils.js"),l=t("__hodor\\state.js"),d=l.page,u=(d.product,l.cart),p=l.order;i.watchDataLayerForElement=o,i.waitDataLayerElement=function(t,e,r,o){r=r||0,o=o||500;var n=window.setInterval(function(){a(t,e,n)},o);r>0&&window.setTimeout(function(){window.clearInterval(n)},r)},i.searchElement=function(t,e){return a(t,e)},i.scrapeDlOrder=function(t,e){var r=s.get(t,"ecommerce.purchase.actionField"),o=s.get(t,"ecommerce.purchase.products");if(p.currency=s.get(t,"ecommerce.currencyCode"),r&&(p.id=p.number=r.id,p.gross=s.parseFloat(r.revenue),p.discountCode=r.coupon,o)){for(var a=0,n=0;n<o.length;n++){var i=o[n];p.products.add(i),a+=s.parseFloat(i.price)*s.parseInt(i.quantity)}a&&p.gross<a&&(p.discount=s.parseFloat((a-p.gross).toFixed(2)),p.gross=s.parseFloat(a.toFixed(2)))}e()},i.monitorCartChange=function(){o(function(t){return t&&("addToCart"===t.event||"removeFromCart"===t.event)},function(t){u.clear();var e=u.cartAction="add";"removeFromCart"===t.event&&(e="remove",u.cartAction="subtract"),u.products.add(s.get(t,"ecommerce."+e+".products[0]")),c.trackPage()})}},{"__hodor\\platform.js":11,"__hodor\\state.js":13,"__hodor\\utils.js":14}],2:[function(t,e,r){function o(t){if(!F)return void(I||(I=!0,l(function(){F=!0,I=!1,o(t)})));try{var e=k.find(function(e){return e.triggerId===t});e&&(_.data.relatedProductLink=e.url.replace("https://www.kikocosmetics.com",""),_.data.relatedProductImage1=e.image1,_.data.relatedProductImage2=e.image2,_.data.relatedProductImage3=e.image3)}catch(r){p("Error in getProductLink:",r)}}function a(){window.location.pathname.includes("/c/")||window.location.pathname.includes("/golden-oasis/")?E||(E=setInterval(i,1e3)):E&&(clearInterval(E),E=null)}function n(){window.location.pathname.includes("/p/")?S||(S=setInterval(c,1e3)):S&&(clearInterval(S),S=null)}function i(){for(var t=document.querySelectorAll('[class^="product-tile_container__"]'),e=window.location.pathname.split("/")[1],r=0;r<t.length;r++){var o=t[r];if(!o.querySelector(".promo-tag")){var a=o.querySelector('a[class^="product-tile_image__"]');if(a)for(var n=a.getAttribute("href"),i=0;i<j.length;i++){var c=j[i];if(c.tagName[e]){var s=n.replace(/^\/[a-z]{2}-[a-z]{2}\//,"/"),l=Array.isArray(c.urls)?c.urls:[c.urls];if(l.includes(s)){var d=document.createElement("div");d.innerText=c.tagName[e],d.className="promo-tag","Bestseller"===c.tagName[e]?(d.style.position="absolute",d.style.top="10px",d.style.left="10px",d.style.background="black",d.style.color="white",d.style.padding="5px 10px",d.style.fontSize="12px",d.style.fontWeight="bold",d.style.textTransform="uppercase",d.style.borderRadius="0"):(d.style.position="absolute",d.style.bottom="10px",d.style.left="10px",d.style.background="#E92076",d.style.color="white",d.style.padding="3px 8px",d.style.fontSize="10px",d.style.fontWeight="bold",d.style.textTransform="uppercase",d.style.borderRadius="4px");var u=o.querySelector('[class^="product-tile_image__"]');u&&(u.style.position="relative",u.appendChild(d));break}}}}}}function c(){var t=document.querySelector('[class^="product-info_pdpInfo__"]'),e=document.querySelector('[class^="product-info_reviews__"]'),r=document.querySelector(".promo-tag-wrapper");if(t&&e){r&&r.remove();for(var o=window.location.pathname.split("/")[1],a=window.location.pathname,n=a.replace(/^\/[a-z]{2}-[a-z]{2}\//,"/"),i=0;i<j.length;i++){var c=j[i];if(c.tagName[o]){var s=Array.isArray(c.urls)?c.urls:[c.urls];if(s.includes(n)){var l=document.createElement("div");l.innerText=c.tagName[o],l.className="promo-tag",l.style.position="absolute",l.style.background="#E92076",l.style.color="white",l.style.padding="5px 10px",l.style.fontSize="12px",l.style.fontWeight="bold",l.style.textTransform="uppercase",l.style.borderRadius="4px";var d=document.createElement("div");d.className="promo-tag-wrapper",d.style.position="relative",d.style.width="100%",d.style.display="flex",d.style.justifyContent="flex-start",d.style.marginBottom="25px",d.appendChild(l),e.parentNode.insertBefore(d,e);break}}}}}function s(t){return j.length>0?void t():void fetch("https://cdn.fanplayr.com/customers/custom-loader/kiko/product_list.json").then(function(t){if(!t.ok)throw new Error("HTTP error! Status: "+t.status);return t.json()}).then(function(e){if("object"!=typeof e||!Array.isArray(e))throw new Error("Invalid data format: expected a non-empty array");e.forEach(function(t){t.urls=Array.isArray(t.urls)?t.urls:[t.urls]}),j=e,t()}).then(null,function(t){p("Error fetching the product list:",t)})}function l(t){fetch("https://cdn.fanplayr.com/customers/custom-loader/kiko/product_trigger.json").then(function(t){if(!t.ok)throw new Error("HTTP error! Status: "+t.status);return t.json()}).then(function(e){k=e,t()}).then(null,function(t){p("Error fetching the product trigger list:",t)})}function d(){if("prod"===_.type)var t=0,e=setInterval(function(){var r=document.querySelector("[class^='product-info_pdpInfo']");r||t>5?(f.trackPage(),clearInterval(e)):t++},500);else f.trackPage()}function u(){f.trackOrder()}var p=t("__hodor\\log.js"),f=t("__hodor\\platform.js"),m=t("__hodor\\state.js"),y=(t("__hodor\\stash.js"),t("__hodor\\utils.js")),v=t("__hodor\\capabilities.js"),_=(t("__hodor\\jquery.js"),window.JSON,m.user,m.page),g=_.product,h=m.cart,w=m.order,b=t("./gtm"),x=!1,k=[],j=[],E=null,S=null,F=!1,I=!1;try{_.data.language=/^\/(\w\w-\w\w)\//.exec(window.location.pathname)[1]}catch(q){}window.fanplayr_api.push({_type:"onPageView",callback:function(t){t.segments.includes("SHOW_PROMO")&&s(function(){var t=window.location.pathname;setInterval(function(){window.location.pathname!==t&&(t=window.location.pathname,a())},1e3),a()}),t.segments.includes("SHOW_PROMO_PDP")&&s(function(){var t=window.location.pathname;setInterval(function(){window.location.pathname!==t&&(t=window.location.pathname,n())},1e3),n()})}}),b.watchDataLayerForElement(function(t){return t&&"dl_update"===t.event},function(t){function e(t){var e=t.page_type;return"thankyou"===e?"order":"Home"===e?"home":"category"===e||"editorial"===e?("editorial"===e?_.categories.add(t.page_type_section,t.page_type_section):_.categories.add(t.category_id,t.category_name),"cat"):"product"===e?(g.merge({id:t.product_id,sku:t.product_id,name:t.product_name,price:t.product_price,url:window.location.origin+t.page_url}),_.categories.add(t.category_id,t.category_name),o(t.product_id),"prod"):e.toLowerCase()}if("true"===t.user_logged_in?_.data.is_logged_in=!0:_.data.is_logged_in=null,"develop.kiko-milano.vercel.app"===window.location.hostname?f.config.storeDomain="kikocosmetics.dev":f.config.storeDomain="kikocosmetics."+t.region.toLowerCase(),_.type=e(t),"order"===_.type){if(!x){if(w.number=w.id=t.order_number,w.discount=t.order_discount*-1,t.currency_code&&(w.currency=t.currency_code),w.shipping=t.order_shipping,w.gross=y.parseFloat((t.order_revenue-w.shipping+w.discount).toFixed(2)),w.discountCode=t.order_discount_code,t.order_products&&Array.isArray(t.order_products))for(var r=0;r<t.order_products.length;r++){var a=t.order_products[r];w.products.add({id:a.product_id,sku:a.product_id,name:a.product_name,price:a.product_price,quantity:a.product_quantity})}x=!0,u(),window.setInterval(function(){x=!1},5e3)}}else{if(v.applyToCartUrl=window.location.origin+window.location.pathname+"?fpVoucherCode=%c","false"===t.user_logged_in?_.data.user_logged_in=!1:_.user_logged_in=!0,Array.isArray(t.incart_products)){h.clear(),h.currency=t.currency_code;for(var n=0;n<t.incart_products.length;n++){var i=t.incart_products[n];h.products.add({id:i.product_id,sku:i.product_id,name:i.product_name,price:i.product_price,quantity:i.product_quantity})}h.updateTotals()}_.url=window.location.href,d()}}),window.fpWebPushSubscribe=function(){window.fanplayr&&window.fanplayr.webPushSubscribe&&window.fanplayr.webPushSubscribe().then(function(t){window.fanplayr.platform.state.page.data.webPushAnswer=1,window.fanplayr.platform.trackPage()})},window.fpHideOnScroll=function(){window.addEventListener("scroll",function(){_.data.userHasScrolled||(_.data.userHasScrolled=1,d())})}},{"./gtm":1,"__hodor\\capabilities.js":5,"__hodor\\jquery.js":9,"__hodor\\log.js":10,"__hodor\\platform.js":11,"__hodor\\stash.js":12,"__hodor\\state.js":13,"__hodor\\utils.js":14}],3:[function(t,e,r){"use strict";function o(e){if(!u){u=!0,s.accountKey&&(e.platform.config.accountKey=s.accountKey);var r=e.require("platform/utils");for(var o in r)l[o]=r[o];n.createStash=e.require("platform/stash").create;var a=n.stash=n.createStash(l.merge({name:"adaptor",scope:"domain"},s.stash||{}));n.fanplayr=e,n.$=e.$,n._=l,a.load(function(){var r=t("__project\\main.js");e.adaptor=l.merge({},n,r||{}),n.emit("ready",e,e.$,l)})}}var a=t("./emitter"),n=e.exports={},i=window.fanplayr=window.fanplayr||{};n.api=window.fanplayr_api=window.fanplayr_api||[],a.mixin(n);var c=n.log=t("./log"),s=n.config=t("./config"),l=n.utils=t("./utils");n.isInFrame=function(){var t=!0;try{var e=window;t=e.top===e||e.top===e.self||!e.frameElement}catch(r){}return!t};var d=s.collector;s.version&&(n.version=s.version);var u,p=n.isInFrame();if(!p||i.allowInFrame||s.allowInFrame)if(!i.adaptor||d){i.adaptor=n;var f=function(){t("./fanplayr-init")(o,n.environment,s)},m=t("__hodor\\boot.js");"function"==typeof m?m(f):setTimeout(f,0)}else{c("Adaptor already loaded. Skip.");var y=i.adaptor&&i.adaptor.onReload;"function"==typeof y&&y()}else c("Adaptor prevent loading in frame: "+(window.frameElement&&window.frameElement.src))},{"./config":6,"./emitter":7,"./fanplayr-init":8,"./log":10,"./utils":14,"__project\\main.js":2,"__hodor\\boot.js":4}],4:[function(t,e,r){"use strict"},{}],5:[function(t,e,r){"use strict";e.exports=t("./adaptor").fanplayr.platform.capabilities},{"./adaptor":3}],6:[function(t,e,r){"use strict";e.exports={type:"adaptor",name:"kiko",version:"1.0.25",accountKey:"3280e398035a5a64293d45b03eb03b74",adaptorVersion:1}},{}],7:[function(t,e,r){"use strict";function o(){this.events={},this.emitCache={}}var a=Array.prototype.slice;o.mixin=function(t){var e=new o;return t.on=function(){return e.on.apply(e,a.call(arguments))},t.emit=function(){return e.emit.apply(e,a.call(arguments))},t.$emitter=e,t},o.prototype={on:function(t,e,r){var o=this;if("function"==typeof e){var a=r;r=e,e=a}e||(e={});var n=o.events[t];n||(n=o.events[t]=[]);var i={options:e,cb:r};if(e.init){var c=o.emitCache[t];c&&o.invoke(i,c)}n.push(i)},emit:function(t){var e=this,r=a.call(arguments,1);e.emitCache[t]=r;var o=e.events[t];if(o)for(var n=0,i=o.length;n<i;n++)e.invoke(o[n],r)},invoke:function(t,e){t.cb.apply(t.options.context||t.cb,e)}},e.exports=o},{}],8:[function(t,e,r){"use strict";t("./log");e.exports=function(t,e,r){!function(o,a){var n=o.fanplayr,i="fanplayr_ready";if(n){var c=n._loadState;2===c&&t(n);var s=o[i];if(o[i]=function(e,r){s&&s(e,r),t(e)},!c){var l=a.createElement("script");l.async=!0,l.src="//cdn.fanplayr.com/client/"+(e||"production")+"/loader.js";var d=a.getElementsByTagName("script")[0],u=r.injectMode||"beforeFirstScript";d&&"beforeFirstScript"===u?d.parentNode.insertBefore(l,d):a.head&&"head"===u?a.head.appendChild(l):a.body&&a.body.appendChild(l)}}}(window,document)}},{"./log":10}],9:[function(t,e,r){"use strict";e.exports=t("./adaptor").fanplayr.$},{"./adaptor":3}],10:[function(t,e,r){"use strict";function o(t){var e=c;return n&&(e="function"==typeof n.bind?n.bind(a,"["+t+"]"):function(){var e=Array.prototype.slice.call(arguments);e.unshift("["+t+"]"),n(e.join(""))}),e.create=o,e.info=e,e.error=e,e}var a,n;try{a=window.console||window.top.console,n=a&&a.log}catch(i){}var c=function(){};e.exports=o("adaptor")},{}],11:[function(t,e,r){"use strict";e.exports=t("./adaptor").fanplayr.platform},{"./adaptor":3}],12:[function(t,e,r){"use strict";e.exports=t("./adaptor").stash},{"./adaptor":3}],13:[function(t,e,r){"use strict";e.exports=t("./adaptor").fanplayr.platform.state},{"./adaptor":3}],14:[function(require,module,exports){"use strict";function _parseFloat(t,e,r){"undefined"==typeof e&&(e=_parseFloat.defaultValue),r=r||_parseFloat.chars,t=String(t);var o=e;if(t){var a=new RegExp("(-?["+r.substr(0,2)+"]?\\d+[0-9"+r+"]*)"),n=t.match(a);if(n){var i=r.charAt(0);if(r.length>2&&(i+=r.substr(2)),a=new RegExp("["+i+"]","g"),t=n[1].replace(a,""),o=parseFloat(t.replace(r.charAt(1),".")),isNaN(o))return e}}return o}var _=module.exports={},log=require("./log");_.parseInt=function(t,e){var r=_parseFloat(t,e);return"number"==typeof r?Math.floor(r):r},_.parseFloat=_parseFloat,_parseFloat.defaultValue=0,_parseFloat.chars=",.";var decodeHtmlEl;_.decodeHtml=function(t){return t?(decodeHtmlEl||(decodeHtmlEl=document.createElement("div")),decodeHtmlEl.innerHTML=t,decodeHtmlEl.firstChild.nodeValue):t},_.waitUntil=function(evaluate,intervalMs,callback){if(2===arguments.length&&(callback=intervalMs,intervalMs=500),"string"==typeof evaluate){var evalPath=evaluate;evaluate=function evaluate(){return eval(evalPath)}}var iterator=function t(){var e=evaluate();e?callback(e):setTimeout(t,intervalMs)};iterator()}},{"./log":10}]},{},[3]);
//# sourceMappingURL=adaptor.js.map
